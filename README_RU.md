![Python](https://img.shields.io/badge/python-3.11-blue)
![License](https://img.shields.io/badge/license-MIT-green)

# üì¶ Chat Service (FastAPI + WebSockets)

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.  
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **FastAPI** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **WebSocket** –¥–ª—è —á–∞—Ç–æ–≤ –∏ **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.  
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **PostgreSQL** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ —á–∞—Ç–∞—Ö, –∞ **MongoDB** ‚Äî –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- üîë –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (**JWT**).  
- üë• –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏.  
- üí¨ –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ **WebSocket**.  
- üóÑÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ **MongoDB**, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ‚Äî –≤ **PostgreSQL**.  
- üìë –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —á–µ—Ä–µ–∑ **Swagger UI** (`/docs`).  

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- **–Ø–∑—ã–∫ / –§—Ä–µ–π–º–≤–æ—Ä–∫**: Python 3.12, FastAPI, AsyncIO  
- **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL, MongoDB  
- **ORM –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è**: SQLAlchemy, Pydantic  
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: Docker, Docker Compose  
- **CI/CD**: GitLab CI/CD (–ª–∏–Ω—Ç–µ—Ä—ã, —Ç–µ—Å—Ç—ã, –ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker-–æ–±—Ä–∞–∑–æ–≤), Portainer –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤  
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:  
  - Pytest (—é–Ω–∏—Ç, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ API-—Ç–µ—Å—Ç—ã)  
  - Locust (–Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)  
  - –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ CI/CD –ø–∞–π–ø–ª–∞–π–Ω –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ DevOps  

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
```bash
git clone https://github.com/VtGoodgame/Chat_service.git
cd Chat_service
```
### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü—Ä–∏–º–µ—Ä .env 
```env
# ======================
# üì¶ DATABASE SETTINGS
# ======================
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=chat_service
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# ======================
# üîê JWT / AUTH
# ======================
SECRET_KEY=change-me-in-prod
ACCESS_TOKEN_EXPIRE_MINUTES=43200  # 30 –¥–Ω–µ–π
ALGORITHM=HS256

# ======================
# üîÑ REDIS
# ======================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# ======================
# üçÉ MONGODB
# ======================
MONGO_URL=mongodb://localhost:27017

# ======================
# üåê BACKEND URL
# ======================
BACKEND_URL=http://localhost:8000

# ======================
# ‚öôÔ∏è SERVICE PREFIXES
# ======================
PATH_PREFIX=/api/chat-service
AUTH_PREFIX=/api/auth-service
USER_PREFIX=/api/user-service
```
### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- API –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞: http://localhost:8000
- Swagger: http://localhost:8000/docs

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç- –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
```bash
pytest -v
```

**–ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä–∏–º–µ—Ä –¥–ª—è Locust):**
```bash
locust -f load_tests/locustfile.py --host=http://localhost:8000
```
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Locust –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:8089

### üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
```scss
Chat_service/
  ‚îú‚îÄ .gitlab-ci/                              // –ø–∞–π–ø–ª–∞–π–Ω—ã/—à–∞–±–ª–æ–Ω—ã –¥–ª—è GitLab CI
  ‚îú‚îÄ db/                                      // –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ë–î
  ‚îÇ   ‚îú‚îÄ mongo.py
  ‚îÇ   ‚îî‚îÄ posgres.py                           // –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
  ‚îú‚îÄ schemas/                                 // Pydantic-—Å—Ö–µ–º—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è I/O)
  ‚îÇ   ‚îú‚îÄ message.py
  ‚îÇ   ‚îî‚îÄ user.py
  ‚îú‚îÄ src/                                     // —Ä–æ—É—Ç—ã/–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  ‚îÇ   ‚îú‚îÄ auth.py
  ‚îÇ   ‚îú‚îÄ blacklist.py
  ‚îÇ   ‚îî‚îÄ concts.py                            // –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
  ‚îú‚îÄ test/                                    // —Ç–µ—Å—Ç—ã
  ‚îÇ   ‚îú‚îÄ integration_main_test.py             // –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ
  ‚îÇ   ‚îú‚îÄ locust_test.py                       // –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ (Locust)
  ‚îÇ   ‚îî‚îÄ unit_mongo_test.py                   // —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
  ‚îú‚îÄ Dockerfile                               // —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  ‚îú‚îÄ .gitignore
  ‚îú‚îÄ .gitlab-ci.yml                           // –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª CI
  ‚îú‚îÄ docker-compose.yml                       // –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
  ‚îú‚îÄ main.py                                  // —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  ‚îú‚îÄ README.md
  ‚îî‚îÄ requirements.txt                         // –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

```
